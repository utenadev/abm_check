# Markdown API Reference

Markdownç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

## ã‚¯ãƒ©ã‚¹

### `MarkdownGenerator`

ç•ªçµ„æƒ…å ±ã‹ã‚‰Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```python
MarkdownGenerator()
```

**ä¾‹:**
```python
from abm_check.infrastructure.markdown import MarkdownGenerator

generator = MarkdownGenerator()
```

#### ãƒ¡ã‚½ãƒƒãƒ‰

##### `generate_program_md(program: Program) -> str`

ç•ªçµ„æƒ…å ±ã‹ã‚‰Markdownæ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `program`: Programã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

**æˆ»ã‚Šå€¤:** Markdownå½¢å¼ã®æ–‡å­—åˆ—

**ä¾‹:**
```python
from abm_check.infrastructure.markdown import MarkdownGenerator
from abm_check.infrastructure.storage import ProgramStorage

storage = ProgramStorage()
generator = MarkdownGenerator()

program = storage.find_program("26-249")
md_content = generator.generate_program_md(program)
print(md_content)
```

##### `save_program_md(program: Program, output_dir: str = "output") -> Path`

ç•ªçµ„æƒ…å ±ã‚’Markdownãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `program`: Programã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `output_dir`: å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "output"ï¼‰

**æˆ»ã‚Šå€¤:** ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®Path

**ä¾‹:**
```python
generator = MarkdownGenerator()
program = storage.find_program("26-249")

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ï¼ˆoutput/26-249/program.mdï¼‰
file_path = generator.save_program_md(program)
print(f"Saved to: {file_path}")

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜
file_path = generator.save_program_md(program, output_dir="docs")
```

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### Markdownã®æ§‹é€ 

```markdown
# ç•ªçµ„ã‚¿ã‚¤ãƒˆãƒ«

## ç•ªçµ„æƒ…å ±

- **ç•ªçµ„ID**: 26-249
- **URL**: https://abema.tv/video/title/26-249
- **ç·ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°**: 24
- **æœ€æ–°è©±**: ç¬¬12è©±
- **å–å¾—æ—¥æ™‚**: 2025/01/08 12:00:00

## ã‚µãƒ ãƒã‚¤ãƒ«

![Thumbnail](https://example.com/thumb.png)

## ç•ªçµ„èª¬æ˜

ç•ªçµ„ã®èª¬æ˜æ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚

## ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¸€è¦§

- é€šå¸¸ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰: 12è©±
- DLå¯èƒ½: 10è©±
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®š: 2è©±
- ç‰¹åˆ¥ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ (PVç­‰): 0è©±

### é€šå¸¸ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰

| DLå¯å¦ | è©±æ•° | ã‚¿ã‚¤ãƒˆãƒ« |
|--------|------|----------|
| âœ… | 01 | ç¬¬1è©± ã‚¿ã‚¤ãƒˆãƒ« |
| âœ… | 02 | ç¬¬2è©± ã‚¿ã‚¤ãƒˆãƒ« |
| ğŸ”’ | 03 | ç¬¬3è©± ã‚¿ã‚¤ãƒˆãƒ« (ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ) |

### ç‰¹åˆ¥ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ (PVç­‰)

| DLå¯å¦ | è©±æ•° | ã‚¿ã‚¤ãƒˆãƒ« |
|--------|------|----------|
| âœ… | 100 | PV |
| âœ… | 101 | ç‰¹ç•ª |

---

_Generated by abm_check_
```

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª¬æ˜

**ç•ªçµ„æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- ç•ªçµ„ID
- ç•ªçµ„URL
- ç·ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°
- æœ€æ–°è©±ç•ªå·ï¼ˆé€šå¸¸ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã®ã¿ï¼‰
- å–å¾—æ—¥æ™‚

**ã‚µãƒ ãƒã‚¤ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- ç•ªçµ„ã®ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰

**ç•ªçµ„èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- ç•ªçµ„ã®èª¬æ˜æ–‡ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰

**ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- é€šå¸¸ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°ï¼ˆç•ªå· < 100ï¼‰
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°
- ç‰¹åˆ¥ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°ï¼ˆç•ªå· >= 100ï¼‰

**ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«:**
- DLå¯å¦: âœ…ï¼ˆå¯èƒ½ï¼‰ã¾ãŸã¯ ğŸ”’ï¼ˆä¸å¯ï¼‰
- è©±æ•°: 2æ¡è¡¨ç¤ºï¼ˆ01, 02, ...ï¼‰
- ã‚¿ã‚¤ãƒˆãƒ«

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨

```python
from abm_check.infrastructure.markdown import MarkdownGenerator
from abm_check.infrastructure.fetcher import AbemaFetcher

fetcher = AbemaFetcher()
generator = MarkdownGenerator()

# ç•ªçµ„æƒ…å ±ã‚’å–å¾—
program = fetcher.fetch_program_info("26-249")

# Markdownã‚’ç”Ÿæˆã—ã¦ä¿å­˜
file_path = generator.save_program_md(program)
print(f"Saved to: {file_path}")
```

### Markdownæ–‡å­—åˆ—ã®å–å¾—

```python
generator = MarkdownGenerator()
program = fetcher.fetch_program_info("26-249")

# Markdownæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
md_content = generator.generate_program_md(program)

# æ–‡å­—åˆ—ã¨ã—ã¦åˆ©ç”¨
print(md_content)

# ãƒ•ã‚¡ã‚¤ãƒ«ã«æ‰‹å‹•ã§ä¿å­˜
with open("custom.md", "w", encoding="utf-8") as f:
    f.write(md_content)
```

### è¤‡æ•°ç•ªçµ„ã®Markdownç”Ÿæˆ

```python
from abm_check.infrastructure.markdown import MarkdownGenerator
from abm_check.infrastructure.storage import ProgramStorage

storage = ProgramStorage()
generator = MarkdownGenerator()

programs = storage.load_programs()

for program in programs:
    try:
        file_path = generator.save_program_md(program)
        print(f"âœ“ {program.title} â†’ {file_path}")
    except Exception as e:
        print(f"âœ— {program.title}: {e}")
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®å‡ºåŠ›

```python
generator = MarkdownGenerator()
program = fetcher.fetch_program_info("26-249")

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜
file_path = generator.save_program_md(program, output_dir="markdown_output")
# â†’ markdown_output/26-249/program.md
```

### ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æƒ…å ±ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

ç”Ÿæˆå‰ã«Programã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åŠ å·¥ã™ã‚‹ã“ã¨ã§ã€å‡ºåŠ›å†…å®¹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™:

```python
from copy import deepcopy

# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã®ã¿ã‚’å«ã‚€Markdownã‚’ç”Ÿæˆ
program = fetcher.fetch_program_info("26-249")
filtered_program = deepcopy(program)
filtered_program.episodes = [
    ep for ep in program.episodes if ep.is_downloadable
]

md_content = generator.generate_program_md(filtered_program)
```

### Markdownã®ãƒ‘ãƒ¼ã‚¹

ç”Ÿæˆã•ã‚ŒãŸMarkdownã‚’ä»–ã®ãƒ„ãƒ¼ãƒ«ã§å‡¦ç†:

```python
import markdown
from bs4 import BeautifulSoup

generator = MarkdownGenerator()
program = fetcher.fetch_program_info("26-249")

# Markdownç”Ÿæˆ
md_content = generator.generate_program_md(program)

# HTMLã«å¤‰æ›
html = markdown.markdown(md_content, extensions=['tables'])

# BeautifulSoupã§ãƒ‘ãƒ¼ã‚¹
soup = BeautifulSoup(html, 'html.parser')
```

### ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªMarkdownç·¨é›†

```python
generator = MarkdownGenerator()
program = fetcher.fetch_program_info("26-249")

# Markdownç”Ÿæˆ
md_content = generator.generate_program_md(program)

# è¿½åŠ æƒ…å ±ã‚’æŒ¿å…¥
custom_section = "\n## è¦–è´ãƒ¡ãƒ¢\n\n- ç¬¬1è©±ãŒé¢ç™½ã‹ã£ãŸ\n"
md_content += custom_section

# ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
with open("output/26-249/program_custom.md", "w", encoding="utf-8") as f:
    f.write(md_content)
```

### ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

Markdownãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç‹¬è‡ªã«ç”Ÿæˆã™ã‚‹å ´åˆ:

```python
program = fetcher.fetch_program_info("26-249")

# ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼
table = "| è©±æ•° | ã‚¿ã‚¤ãƒˆãƒ« | DL | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  | æ™‚é–“ |\n"
table += "|------|----------|----|-----------|---------|\n"

for ep in program.episodes:
    if ep.number < 100:  # é€šå¸¸ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã®ã¿
        dl = "âœ…" if ep.is_downloadable else "ğŸ”’"
        premium = "â­" if ep.is_premium_only else ""
        duration_min = ep.duration // 60
        
        table += f"| {ep.number:02d} | {ep.title} | {dl} | {premium} | {duration_min}åˆ† |\n"

print(table)
```

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
output/
â””â”€â”€ 26-249/
    â””â”€â”€ program.md
```

å„ç•ªçµ„ã¯IDã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã€ãã®ä¸­ã«`program.md`ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### ç”Ÿæˆé€Ÿåº¦

- 1ç•ªçµ„ï¼ˆ24ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ï¼‰: < 0.1ç§’
- 100ç•ªçµ„: < 10ç§’
- ä¸»ã«I/OãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º

- 1ç•ªçµ„ï¼ˆ24ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ï¼‰: ç´„2-5KB
- èª¬æ˜æ–‡ãŒé•·ã„å ´åˆ: ç´„5-10KB

### æ¨å¥¨äº‹é …

1. **ä¸€æ‹¬ç”Ÿæˆæ™‚ã®å‡¦ç†**
   - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã‚’å®Ÿè£…
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’é©åˆ‡ã«

2. **ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡**
   - 100ç•ªçµ„ã§ç´„500KBç¨‹åº¦
   - å®šæœŸçš„ã«ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤

3. **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**
   - å¸¸ã«UTF-8ã§ä¿å­˜
   - æ—¥æœ¬èªæ–‡å­—ã‚’æ­£ã—ãå‡¦ç†
