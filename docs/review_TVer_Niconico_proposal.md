# TVer・ニコニコ動画対応機能案へのレビューと提言

## 概要
`docs/feature_TVer+Niconico.md` および `docs/consideration_TVer_niconico.md` を拝見しました。
マルチプラットフォーム対応はツールの価値を大きく高める素晴らしい機能追加です。
既存のクリーンアーキテクチャを生かしつつ、保守性を高めるためのいくつかの技術的提言をまとめました。

## 1. アーキテクチャ・データ設計への提言

### 1.1. 定義ファイルの統合管理 (Single Source of Truth)
**提案**: 定義ファイルをプラットフォームごとに分割（`programs_tver.yaml` 等）せず、**単一の `programs.yaml` で管理し、各番組データに `platform` 属性を持たせる**ことを強く推奨します。

*   **理由**:
    *   ユーザーにとって「どのファイルにどの番組があるか」を意識させない方が使い勝手が良い。
    *   `update-all` の実装がシンプルになる（ファイルループではなく、リストループで済む）。
    *   将来的に「同一アニメの複数プラットフォーム横断検索」などを行う際、データソースが一つの方が扱いやすい。

**データモデル変更案**:
```python
class Program:
    id: str
    platform: str  # 'abema', 'tver', 'niconico'
    # ... 他の共通フィールド
```

### 1.2. Fetcherの抽象化 (Strategy Pattern)
**提案**: `AbemaFetcher` を直接利用するのではなく、共通インターフェース `BaseFetcher` を定義し、各プラットフォームの実装を差し替え可能にします。

*   **構造イメージ**:
    *   `BaseFetcher` (抽象基底クラス)
        *   `fetch_program_info(id)`
    *   `AbemaFetcher` (継承)
    *   `TVerFetcher` (継承)
    *   `NicoFetcher` (継承)
    *   `FetcherFactory`: URLやIDから適切なFetcherインスタンスを生成するファクトリ。

これにより、`main.py` (CLI) は具体的なプラットフォームのロジックを知る必要がなくなり、コードの結合度が下がります。

## 2. CLIコマンド設計への提言

### 2.1. コマンドの統合 (`add` のスマート化)
**提案**: `add-tver`, `add-nico` とコマンドを増やすのではなく、既存の `add` コマンドを拡張し、**URLまたはIDの形式から自動的にプラットフォームを判定**させます。

*   **例**:
    *   `abm_check add https://abema.tv/...` -> Abemaとして登録
    *   `abm_check add https://tver.jp/...` -> TVerとして登録
    *   `abm_check add https://ch.nicovideo.jp/...` -> Nicoとして登録
*   **メリット**: ユーザーはプラットフォームを意識せず「URLを貼り付けるだけ」で済みます。

## 3. プラットフォーム固有の課題への技術的アプローチ

### 3.1. ニコニコ動画: RSSフィードの活用検討
**課題**: チャンネルページのHTMLスクレイピングは、サイト構造変更で壊れやすく、メンテナンスコストが高いです。
**提案**: ニコニコ動画のチャンネルはRSSフィードを提供している場合が多いです（例: `https://ch.nicovideo.jp/{channel}/rss`）。
まずはRSSフィードで更新情報（新規エピソードのURL）が取得できないか調査することを推奨します。RSSは構造化データ（XML）なので、HTMLスクレイピングより遥かに安定しています。

### 3.2. TVer: 配信期限の管理
**課題**: TVerは「1週間限定」など配信期限が厳しいです。
**提案**: `Episode` モデルに `expiration_date` (配信終了日時) を追加し、ダウンロードリスト生成時に「あと〇〇時間で終了」のような警告コメントを付与すると、ユーザーにとって非常に有益です。

## 4. まとめ
機能追加の方向性は非常に良いと思います。実装の際は、将来さらにプラットフォームが増える（例: YouTube, DMM TV等）ことも見据えて、**「プラットフォームごとのロジックの分離」と「操作の統一（共通コマンド）」**を意識した設計にすることをお勧めします。
